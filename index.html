<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
<meta property="og:type" content="website">
<meta property="og:title" content="Bruce Liu&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Bruce Liu&#39;s Blog">
<meta property="og:description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bruce Liu&#39;s Blog">
<meta name="twitter:description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">






  <link rel="canonical" href="http://yoursite.com/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Bruce Liu's Blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bruce Liu's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/11/java8tomap/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/11/java8tomap/" class="post-title-link" itemprop="http://yoursite.com/index.html">java8tomap</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-08-11 17:11:31 / 修改时间：17:12:41" itemprop="dateCreated datePublished" datetime="2020-08-11T17:11:31+08:00">2020-08-11</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Map&lt;String, JSONObject&gt; moudlesDataMap =</span><br><span class="line">             allModulesData.stream()</span><br><span class="line">                     .collect(Collectors.toMap(</span><br><span class="line">                             item -&gt; (item.get(<span class="string">"name"</span>).toString()), item -&gt; item, (oldValue, newValue) -&gt; newValue));</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/21/JWT-Token基础/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/07/21/JWT-Token基础/" class="post-title-link" itemprop="http://yoursite.com/index.html">JWT Token基础</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-07-21 10:15:55" itemprop="dateCreated datePublished" datetime="2020-07-21T10:15:55+08:00">2020-07-21</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/13/马士兵多线程20200713/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/07/13/马士兵多线程20200713/" class="post-title-link" itemprop="http://yoursite.com/index.html">马士兵多线程20200713</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-07-13 14:06:21" itemprop="dateCreated datePublished" datetime="2020-07-13T14:06:21+08:00">2020-07-13</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/09/尚硅谷k8s笔记/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/07/09/尚硅谷k8s笔记/" class="post-title-link" itemprop="http://yoursite.com/index.html">尚硅谷k8s笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-07-09 15:15:03" itemprop="dateCreated datePublished" datetime="2020-07-09T15:15:03+08:00">2020-07-09</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/30/spring跨域配置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/30/spring跨域配置/" class="post-title-link" itemprop="http://yoursite.com/index.html">spring跨域配置</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-30 14:00:06 / 修改时间：14:03:19" itemprop="dateCreated datePublished" datetime="2020-06-30T14:00:06+08:00">2020-06-30</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以下内容来源于 <code>spring</code> 官方网站</p>
<p><a href="https://spring.io/blog/2015/06/08/cors-support-in-spring-framework" target="_blank" rel="noopener">https://spring.io/blog/2015/06/08/cors-support-in-spring-framework</a></p>
<h2 id="CORS-support-in-Spring-Framework"><a href="#CORS-support-in-Spring-Framework" class="headerlink" title="CORS support in Spring Framework"></a><a href="https://spring.io/blog/2015/06/08/cors-support-in-spring-framework" target="_blank" rel="noopener">CORS support in Spring Framework</a></h2><p><a href="https://spring.io/blog/2015/06/08/cors-support-in-spring-framework#disqus_thread" target="_blank" rel="noopener">https://spring.io/blog/2015/06/08/cors-support-in-spring-framework#disqus_thread</a>)</p>
<p>For security reasons, browsers prohibit AJAX calls to resources residing outside the current origin. For example, as you’re checking your bank account in one tab, you could have the evil.com website in another tab. The scripts from evil.com shouldn’t be able to make AJAX requests to your bank API (withdrawing money from your account!) using your credentials.</p>
<p><a href="https://spring.io/understanding/CORS" target="_blank" rel="noopener">Cross-origin resource sharing</a> (CORS) is a <a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener">W3C specification</a> implemented by <a href="https://caniuse.com/#feat=cors" target="_blank" rel="noopener">most browsers</a> that allows you to specify in a flexible way what kind of cross domain requests are authorized, instead of using some less secured and less powerful hacks like IFrame or JSONP.</p>
<p><a href="https://spring.io/blog/2015/07/31/spring-framework-4-2-goes-ga" target="_blank" rel="noopener">Spring Framework 4.2 GA</a> provides <a href="https://jira.spring.io/browse/SPR-9278" target="_blank" rel="noopener">first class support for CORS</a> out-of-the-box, giving you an easier and more powerful way to configure it than typical <a href="http://software.dzhuvinov.com/cors-filter.html" target="_blank" rel="noopener">filter based</a> solutions.</p>
<p>Spring MVC provides high-level configuration facilities, described bellow.</p>
<h2 id="Controller-method-CORS-configuration"><a href="#Controller-method-CORS-configuration" class="headerlink" title="Controller method CORS configuration"></a>Controller method CORS configuration</h2><p>You can add to your <code>@RequestMapping</code> annotated handler method a <a href="https://docs.spring.io/spring-framework/docs/4.2.x/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" target="_blank" rel="noopener"><code>@CrossOrigin</code></a> annotation in order to enable CORS on it (by default <code>@CrossOrigin</code> allows all origins and the HTTP methods specified in the <code>@RequestMapping</code> annotation):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/account&quot;)</span><br><span class="line">public class AccountController &#123;</span><br><span class="line"></span><br><span class="line">	@CrossOrigin</span><br><span class="line">	@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public Account retrieve(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public void remove(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is also possible to enable CORS for the whole controller:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@CrossOrigin(origins = &quot;http://domain2.com&quot;, maxAge = 3600)</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/account&quot;)</span><br><span class="line">public class AccountController &#123;</span><br><span class="line"></span><br><span class="line">	@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public Account retrieve(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public void remove(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this example CORS support is enabled for both <code>retrieve()</code> and <code>remove()</code> handler methods, and you can also see how you can customize the CORS configuration using <code>@CrossOrigin</code> attributes.</p>
<p>You can even use both controller and method level CORS configurations, Spring will then combine both annotation attributes to create a merged CORS configuration.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@CrossOrigin(maxAge = 3600)</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/account&quot;)</span><br><span class="line">public class AccountController &#123;</span><br><span class="line"></span><br><span class="line">	@CrossOrigin(origins = &quot;http://domain2.com&quot;)</span><br><span class="line">	@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public Account retrieve(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">	public void remove(@PathVariable Long id) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you are using Spring Security, make sure to <a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/cors.html" target="_blank" rel="noopener">enable CORS at Spring Security level</a> as well to allow it to leverage the configuration defined at Spring MVC level.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">		http.cors().and()...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Global-CORS-configuration"><a href="#Global-CORS-configuration" class="headerlink" title="Global CORS configuration"></a>Global CORS configuration</h2><p>In addition to fine-grained, annotation-based configuration you’ll probably want to define some global CORS configuration as well. This is similar to using filters but can be declared withing Spring MVC and combined with fine-grained <code>@CrossOrigin</code> configuration. By default all origins and <code>GET</code>, <code>HEAD</code> and <code>POST</code> methods are allowed.</p>
<h3 id="JavaConfig"><a href="#JavaConfig" class="headerlink" title="JavaConfig"></a>JavaConfig</h3><p>Enabling CORS for the whole application is as simple as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebMvc</span><br><span class="line">public class WebConfig extends WebMvcConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">		registry.addMapping(&quot;/**&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you are using Spring Boot, it is recommended to just declare a <code>WebMvcConfigurer</code> bean as following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">        return new WebMvcConfigurerAdapter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">                registry.addMapping(&quot;/**&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;COPY</span><br></pre></td></tr></table></figure>
<p>You can easily change any properties, as well as only apply this CORS configuration to a specific path pattern:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">	registry.addMapping(&quot;/api/**&quot;)</span><br><span class="line">		.allowedOrigins(&quot;http://domain2.com&quot;)</span><br><span class="line">		.allowedMethods(&quot;PUT&quot;, &quot;DELETE&quot;)</span><br><span class="line">			.allowedHeaders(&quot;header1&quot;, &quot;header2&quot;, &quot;header3&quot;)</span><br><span class="line">		.exposedHeaders(&quot;header1&quot;, &quot;header2&quot;)</span><br><span class="line">		.allowCredentials(false).maxAge(3600);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you are using Spring Security, make sure to <a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/cors.html" target="_blank" rel="noopener">enable CORS at Spring Security level</a> as well to allow it to leverage the configuration defined at Spring MVC level.</p>
<h3 id="XML-namespace"><a href="#XML-namespace" class="headerlink" title="XML namespace"></a>XML namespace</h3><p>It is also possible to configure CORS with the <a href="https://jira.spring.io/browse/SPR-13046" target="_blank" rel="noopener">mvc XML namespace</a>.</p>
<p>This minimal XML configuration enable CORS on <code>/**</code> path pattern with the same default properties than the JavaConfig one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:cors&gt;</span><br><span class="line">	&lt;mvc:mapping path=&quot;/**&quot; /&gt;</span><br><span class="line">&lt;/mvc:cors&gt;COPY</span><br></pre></td></tr></table></figure>
<p>It is also possible to declare several CORS mappings with customized properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:cors&gt;</span><br><span class="line"></span><br><span class="line">	&lt;mvc:mapping path=&quot;/api/**&quot;</span><br><span class="line">		allowed-origins=&quot;http://domain1.com, http://domain2.com&quot;</span><br><span class="line">		allowed-methods=&quot;GET, PUT&quot;</span><br><span class="line">		allowed-headers=&quot;header1, header2, header3&quot;</span><br><span class="line">		exposed-headers=&quot;header1, header2&quot; allow-credentials=&quot;false&quot;</span><br><span class="line">		max-age=&quot;123&quot; /&gt;</span><br><span class="line"></span><br><span class="line">	&lt;mvc:mapping path=&quot;/resources/**&quot;</span><br><span class="line">		allowed-origins=&quot;http://domain1.com&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mvc:cors&gt;</span><br></pre></td></tr></table></figure>
<p>If you are using Spring Security, don’t forget to <a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/cors.html" target="_blank" rel="noopener">enable CORS at Spring Security level</a> as well:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;http&gt;</span><br><span class="line">	&lt;!-- Default to Spring MVC&apos;s CORS configuration --&gt;</span><br><span class="line">	&lt;cors /&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;/http&gt;</span><br></pre></td></tr></table></figure>
<h2 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h2><p>CORS requests (<a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/FrameworkServlet.java#L906" target="_blank" rel="noopener">including preflight ones with an <code>OPTIONS</code> method</a>) are automatically dispatched to the various <code>HandlerMapping</code>s registered. They handle CORS preflight requests and intercept CORS simple and actual requests thanks to a <a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/cors/CorsProcessor.html" target="_blank" rel="noopener">CorsProcessor</a> implementation (<a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/cors/DefaultCorsProcessor.java" target="_blank" rel="noopener">DefaultCorsProcessor</a> by default) in order to add the relevant CORS response headers (like <code>Access-Control-Allow-Origin</code>). <a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" target="_blank" rel="noopener">CorsConfiguration</a> allows you to specify how the CORS requests should be processed: allowed origins, headers, methods, etc. It can be provided in various ways:</p>
<ul>
<li><a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/servlet/handler/AbstractHandlerMapping.html#setCorsConfiguration-java.util.Map-" target="_blank" rel="noopener"><code>AbstractHandlerMapping#setCorsConfiguration()</code></a> allows to specify a <code>Map</code> with several <a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" target="_blank" rel="noopener">CorsConfiguration</a> mapped on path patterns like <code>/api/**</code></li>
<li>Subclasses can provide their own <code>CorsConfiguration</code> by overriding <code>AbstractHandlerMapping#getCorsConfiguration(Object, HttpServletRequest)</code> method</li>
<li>Handlers can implement <a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/cors/CorsConfigurationSource.html" target="_blank" rel="noopener"><code>CorsConfigurationSource</code></a> interface (like <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/resource/ResourceHttpRequestHandler.java" target="_blank" rel="noopener"><code>ResourceHttpRequestHandler</code></a> now does) in order to provide a <a href="https://docs.spring.io/spring/docs/4.2.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" target="_blank" rel="noopener">CorsConfiguration</a> for each request.</li>
</ul>
<h2 id="Filter-based-CORS-support"><a href="#Filter-based-CORS-support" class="headerlink" title="Filter based CORS support"></a>Filter based CORS support</h2><p>As an alternative to other methods presented above, Spring Framework also provides a <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/filter/CorsFilter.html" target="_blank" rel="noopener">CorsFilter</a>. In that case, instead of using <code>@CrossOrigin</code> or <code>WebMvcConfigurer#addCorsMappings(CorsRegistry)</code>, you can for example declare the filter as following in your Spring Boot application:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public FilterRegistrationBean corsFilter() &#123;</span><br><span class="line">		UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">		CorsConfiguration config = new CorsConfiguration();</span><br><span class="line">		config.setAllowCredentials(true);</span><br><span class="line">		config.addAllowedOrigin(&quot;http://domain1.com&quot;);</span><br><span class="line">		config.addAllowedHeader(&quot;*&quot;);</span><br><span class="line">		config.addAllowedMethod(&quot;*&quot;);</span><br><span class="line">		source.registerCorsConfiguration(&quot;/**&quot;, config);</span><br><span class="line">		FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));</span><br><span class="line">		bean.setOrder(0);</span><br><span class="line">		return bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/04/取余和取模的区别/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/04/取余和取模的区别/" class="post-title-link" itemprop="http://yoursite.com/index.html">取余和取模的区别</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-04 11:04:34 / 修改时间：11:31:43" itemprop="dateCreated datePublished" datetime="2020-06-04T11:04:34+08:00">2020-06-04</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>取余%</code> 和 <code>取模 mod</code> 两种运算，既有相同之处也有不同的地方</p>
<p><code>a % b</code> 和 <code>a mod b</code> 的公式都为 <code>result = a - b * c ;c = a / b (b ≠ 0);</code> </p>
<p>两者的区别是 在于 <code>c</code> 的计算方式</p>
<p>在 <code>a % b</code> 时 ,<code>c</code>的结果<strong>向零取整</strong>，如 <code>a = 36, b = -10 则 c=-3</code>; </p>
<p>在 <code>a mod b</code> 时，<code>c</code>的结果向<strong>负无穷取整</strong>，如 <code>a = 36, b = -10 则 c=-4</code>因为比 <code>-3.6</code> 小的最接近的一个整数是 <code>-4</code> ; </p>
<p>所以 有如下的运算</p>
<p><code>36 % -10 = 36 - (-10) * c = 36 - (-10) *(-3) = 36 -30 = 6</code>，结果为 <code>6</code></p>
<p><code>36 mod 10 = 36 - (-10) * c = 36 - (-10) * (-4) = 36 -40 = -4</code> ,结果为 <code>-4</code>   </p>
<p>更一般的规律</p>
<p>在 <code>取余(%)</code>运算中，运算结果的符号和被除数(a)保持一致，即 <code>a</code> 为正，运算的结果就为正， <code>a</code> 为负，运算的结果就为负</p>
<p>在 <code>取模(mod)</code>运算中，运算结果的符号和除数(b)保持一致，即 <code>b</code> 为正，运算的结果就为正， <code>b</code> 为负，运算的结果就为负</p>
<p>在 <code>java</code> 中的运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(36 % 10);  //6</span><br><span class="line">        System.out.println(36 % -10); //6</span><br><span class="line">        System.out.println(-36 % 10); //-6</span><br><span class="line">        System.out.println(-36 % -10); //-6</span><br><span class="line">        System.out.println(Math.floorMod(36, 10));  //6</span><br><span class="line">        System.out.println(Math.floorMod(36, -10)); //-4</span><br><span class="line">        System.out.println(Math.floorMod(-36, 10));  //4</span><br><span class="line">        System.out.println(Math.floorMod(-36, -10)); //-6</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">打印结果如下</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">-6</span><br><span class="line">-6</span><br><span class="line">6</span><br><span class="line">-4</span><br><span class="line">4</span><br><span class="line">-6</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/03/java-in-puzzles-summary/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/03/java-in-puzzles-summary/" class="post-title-link" itemprop="http://yoursite.com/index.html">java in puzzles summary</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-03 15:57:23" itemprop="dateCreated datePublished" datetime="2020-06-03T15:57:23+08:00">2020-06-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-06-04 11:02:37" itemprop="dateModified" datetime="2020-06-04T11:02:37+08:00">2020-06-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第二章-Expressive-Puzzles"><a href="#第二章-Expressive-Puzzles" class="headerlink" title="第二章 Expressive Puzzles"></a>第二章 Expressive Puzzles</h2><h2 id="第三章-with-Character"><a href="#第三章-with-Character" class="headerlink" title="第三章 with Character"></a>第三章 with Character</h2><h3 id="Puzzle-11-The-Last-Laugh"><a href="#Puzzle-11-The-Last-Laugh" class="headerlink" title="Puzzle 11 The Last Laugh"></a>Puzzle 11 The Last Laugh</h3><p>执行下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LastLaugh</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">            System.out.print(<span class="string">"H"</span> + <span class="string">"a"</span>);</span><br><span class="line">            System.out.print(’H’ + ’a’);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>预期</strong>的打印结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HaHa</span><br></pre></td></tr></table></figure>
<p>但是实际情况如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ha169</span><br></pre></td></tr></table></figure>
<p>第二个打印语句实际上是将两个字符的ASCII码值相加的结果</p>
<p>下面的语句是可以将两个字符连起来的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.print(&quot;&quot;+&apos;H&apos; + &apos;a&apos;);</span><br><span class="line">// 输出Ha</span><br></pre></td></tr></table></figure>
<p>下面的例子中 不会输出两个数字相加的结果，而是将数字相加的操作作为字符串打印出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(&quot;2 + 2 = &quot; + 2+2);</span><br><span class="line">// 输出2 + 2 = 22</span><br><span class="line">显然我们期望的结果是 2 + 2 = 4</span><br></pre></td></tr></table></figure>
<p>从 Java1.5 开始，下面的语句也可以将 两个 <code>char</code> ，作为字符串链接输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(&quot;%c%c&quot;, &apos;H&apos;, &apos;a&apos;);</span><br></pre></td></tr></table></figure>
<p><strong><em>结论</em></strong></p>
<blockquote>
<p>the <code>+</code> operator performs string concatenation if and only if at least one of its operands is of type String; otherwise, it performs addition.</p>
<p>当且仅当运算符中的至少一个是字符串类型时，<code>+</code> 运算符才执行字符串连接，在其他情况下执行加操作</p>
</blockquote>
<p>如果需要进行字符串连接的几个值之间没有一个是 <code>String</code> 类型，那么有以下几个选择：</p>
<ol>
<li>增加一个空字符串 <code>&quot;&quot;</code></li>
<li>使用 <code>String.valueOf()</code> 进行显式转换；</li>
<li>使用 <code>StringBuffer</code>/<code>StringBuilder</code></li>
<li>使用上面提到的 <code>System.out.printf(&quot;%c%c&quot;, &#39;H&#39;, &#39;a&#39;);</code>的写法</li>
</ol>
<h3 id="Puzzle12-ABC"><a href="#Puzzle12-ABC" class="headerlink" title="Puzzle12 ABC"></a>Puzzle12 ABC</h3><p>运行下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String letters = <span class="string">"ABC"</span>;</span><br><span class="line"><span class="keyword">char</span>[] numbers = &#123; <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span> &#125;;</span><br><span class="line">System.out.println(letters + <span class="string">" easy as "</span> + numbers);</span><br></pre></td></tr></table></figure>
<p>预期输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ABC easy as 123</span><br></pre></td></tr></table></figure>
<p>实际输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ABC easy as [C@5e2de80c</span><br></pre></td></tr></table></figure>
<p>之所以会出现上面的结果是因为 在打印的时候 <code>numbers</code> 调用了 <code>Object</code> 的 <code>toString</code> 方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public String toString() &#123;</span><br><span class="line">       return getClass().getName() + &quot;@&quot; + Integer.toHexString(hashCode());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>所以会导致 出现上面的字符串</p>
<p>为了解决上面的问题，可以调用 <code>String.valueOf(char[] data)</code> 方法，该方法会答应出字符数组内所有的字符:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String letters = &quot;ABC&quot;;</span><br><span class="line">char[] numbers = &#123;&apos;1&apos;, &apos;2&apos;, &apos;3&apos;&#125;;</span><br><span class="line">System.out.println(letters + &quot; easy as &quot; + String.valueOf(numbers));</span><br></pre></td></tr></table></figure>
<p>上面的代码输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ABC easy as 123</span><br></pre></td></tr></table></figure>
<p>也可以使用下面的分开输出的方法</p>
<p>调用 <code>println(char[] data)</code> 方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String letters = &quot;ABC&quot;;</span><br><span class="line">       char[] numbers = &#123;&apos;1&apos;, &apos;2&apos;, &apos;3&apos;&#125;;</span><br><span class="line">       System.out.print(letters + &quot; easy as &quot;);</span><br><span class="line">       System.out.println(numbers);</span><br></pre></td></tr></table></figure>
<p><strong><em>总结</em></strong></p>
<blockquote>
<p> char arrays are not strings. To convert a  char array to astring, invoke  String.valueOf(char[]) .char</p>
<p> 数组不是字符串。 要将char数组转换为字符串，请调用String.valueOf（char []）。</p>
</blockquote>
<h3 id="Puzzle-14-Escape-Rout"><a href="#Puzzle-14-Escape-Rout" class="headerlink" title="Puzzle 14 Escape Rout"></a>Puzzle 14 Escape Rout</h3><p>这里实际上是使用 Unicode 标识 ASCII 字符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">"a\u0022.length() + \u0022b"</span>.length());</span><br></pre></td></tr></table></figure>
<p>打印结果是 2</p>
<p>等同于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(&quot;a&quot;.length() + &quot;b&quot;.length());</span><br></pre></td></tr></table></figure>
<p>使用转义之后，即可打印字符串的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(&quot;a\&quot;.length() + \&quot;b&quot;.length());</span><br><span class="line">// 16</span><br></pre></td></tr></table></figure>
<p><strong><em>结论</em></strong></p>
<blockquote>
<p>In summary, prefer escape sequences to Unicode escapes in string and character literals. </p>
<p>总之，相对于字符串和字符文字中的Unicode转义，更喜欢转义序列。</p>
<p>Do not use Unicode escapes to represent ASCII characters. </p>
<p>不要使用Unicode转义符表示ASCII字符。</p>
</blockquote>
<h3 id="Puzzle-20-What’s-My-Class"><a href="#Puzzle-20-What’s-My-Class" class="headerlink" title="Puzzle 20 What’s My Class?"></a>Puzzle 20 What’s My Class?</h3><p>下面的代码是将字符串中的所有点号转换成斜杠</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(MyTest.class.getName());</span><br><span class="line">        System.out.println(</span><br><span class="line">                MyTest.class.getName().replaceAll(<span class="string">"."</span>, <span class="string">"/"</span>) + <span class="string">".class"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最后打印的结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.bruceliu.algorithms.puzzles.MyTest</span><br><span class="line">//////////////////////////////////////.class</span><br></pre></td></tr></table></figure>
<p>出现这个结果的原因是 <code>replaceAll()</code>方法的第一个参数是一个<code>正则表达式</code>(<code>regular expression</code>)，而不是一个字符串序列</p>
<blockquote>
<p>正则表达式“。” 匹配任何单个字符，因此类名的每个字符都用斜杠替换，产生我们看到的输出。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    System.out.println(MyTest.class.getName());</span><br><span class="line">    System.out.println(</span><br><span class="line">                MyTest.class.getName().replaceAll(&quot;\\.&quot;, &quot;/&quot;) + &quot;.class&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自 <code>JAVA 1.5</code> 开始，也可以使用以下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(MyTest.class.getName().</span><br><span class="line">           replaceAll(Pattern.quote(<span class="string">"."</span>), <span class="string">"/"</span>) + <span class="string">".class"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要仅匹配句点字符，正则表达式中的句点必须通过在其前面加上反斜杠（\）进行转义。 因为反斜杠字符在字符串文字中有特殊含义-它开始一个转义序列-后面的斜杠本身必须用第二个反斜杠转义。</p>
</blockquote>
<h3 id="Puzzle-21"><a href="#Puzzle-21" class="headerlink" title="Puzzle: 21"></a>Puzzle: 21</h3><p>执行下面的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(MeToo.class.getName().replaceAll(&quot;\\.&quot;, File.separator) + &quot;.class&quot;);</span><br></pre></td></tr></table></figure>
<p>这段代码在 <code>windows</code> 平台会报错</p>
<p><code>File.separator</code> 在 <code>windows</code> 平台是反斜杠 <code>backslash</code>,反斜杠会对其之后的字符进行转义。而在上面的例子中，反斜杠后面没有其他字符了，所以第二个参数是一个无效的输入。</p>
<p>自 <code>java 1.5</code> 之后有两种方法解决这个问题，方法一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(MyTest.class.getName().replaceAll(&quot;\\.&quot;, Matcher.quoteReplacement(File.separator))+ &quot;.class&quot;);</span><br></pre></td></tr></table></figure>
<p>方法二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(MyTest.class.getName().replace(&quot;.&quot;, File.separator) + &quot;.class&quot;);</span><br><span class="line">注意 replace 方法的第一个参数是 字符序列 而不是正则表达式</span><br></pre></td></tr></table></figure>
<p>在 <code>java 1.5</code> 之前同样也有解决方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(MyTest.class.getName().replace(&apos;.&apos;, File.separatorChar) + &quot;.class&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="Puzzle-23-No-Pain，No-Gain"><a href="#Puzzle-23-No-Pain，No-Gain" class="headerlink" title="Puzzle: 23 No Pain，No Gain."></a>Puzzle: 23 No Pain，No Gain.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rhymes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rnd = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer word = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (rnd.nextInt(<span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                word = <span class="keyword">new</span> StringBuffer(’P’);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                word = <span class="keyword">new</span> StringBuffer(’G’);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                word = <span class="keyword">new</span> StringBuffer(’M’);</span><br><span class="line">        &#125;</span><br><span class="line">        word.append(’a’);</span><br><span class="line">        word.append(’i’);</span><br><span class="line">        word.append(’n’);</span><br><span class="line">        System.out.println(word);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">上面代码的目的是 打印出  Pain,Gain或者Main</span><br><span class="line">但是运行结果是 只打印 `ain`</span><br></pre></td></tr></table></figure>
<p>有如下三个bug</p>
<ol>
<li>rnd.nextInt(2)  的取值范围是[0,2)，2是永远不可能取到的，这里应该改成 rnd.nexInt(3);</li>
<li><code>switch</code> 语句没有 <code>break</code>，应该给每一个分支增加 break;</li>
<li><code>new StringBuffer(char)</code> 实际调用的是 <code>new StringBuffer(int capacity)</code>,即给 <code>StringBuffer</code> 初始化大小，并不是 <code>new StingBuffer(String str)</code> 初始化字符串</li>
</ol>
<p>可以进行如下的修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.util.Random;</span><br><span class="line"></span><br><span class="line">public class Rhymes &#123;</span><br><span class="line">    private static Random rnd = new Random();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        StringBuffer word = null;</span><br><span class="line">        switch (rnd.nextInt(3)) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                word = new StringBuffer(&quot;P&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                word = new StringBuffer(&quot;G&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                word = new StringBuffer(&quot;M&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        word.append(&apos;a&apos;);</span><br><span class="line">        word.append(&apos;i&apos;);</span><br><span class="line">        word.append(&apos;n&apos;);</span><br><span class="line">        System.out.println(word);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码还可以写得更加优雅</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(&quot;PGM&quot;.charAt(rnd.nextInt(3)) + &quot;ain&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="第四章-Loopy-Puzzlers"><a href="#第四章-Loopy-Puzzlers" class="headerlink" title="第四章 Loopy Puzzlers"></a>第四章 Loopy Puzzlers</h2><h3 id="Puzzle-24-A-Big-Delight-in-Every-Byte"><a href="#Puzzle-24-A-Big-Delight-in-Every-Byte" class="headerlink" title="Puzzle 24: A Big Delight in Every Byte"></a>Puzzle 24: A Big Delight in Every Byte</h3>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/27/ElasticsSearch基础/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/27/ElasticsSearch基础/" class="post-title-link" itemprop="http://yoursite.com/index.html">ElasticsSearch例子</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-05-27 14:46:17 / 修改时间：15:18:57" itemprop="dateCreated datePublished" datetime="2020-05-27T14:46:17+08:00">2020-05-27</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>原始数据结构如下</p>
<p>这是一个银行账户的索引</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"state"</span>:<span class="string">"open"</span>,</span><br><span class="line">    <span class="attr">"settings"</span>:&#123;</span><br><span class="line">        <span class="attr">"index"</span>:&#123;</span><br><span class="line">            <span class="attr">"creation_date"</span>:<span class="string">"1590560065840"</span>,</span><br><span class="line">            <span class="attr">"number_of_shards"</span>:<span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"number_of_replicas"</span>:<span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"uuid"</span>:<span class="string">"qJ2GvjkCTXG5hkL-puXqQA"</span>,</span><br><span class="line">            <span class="attr">"version"</span>:&#123;</span><br><span class="line">                <span class="attr">"created"</span>:<span class="string">"7070099"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"provided_name"</span>:<span class="string">"bank"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">        <span class="attr">"_doc"</span>:&#123;</span><br><span class="line">            <span class="attr">"properties"</span>:&#123;</span><br><span class="line">                <span class="attr">"account_number"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"long"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"firstname"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"address"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"balance"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"long"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"gender"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"city"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"employer"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"state"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"age"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"long"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"email"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"lastname"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">                    <span class="attr">"fields"</span>:&#123;</span><br><span class="line">                        <span class="attr">"keyword"</span>:&#123;</span><br><span class="line">                            <span class="attr">"ignore_above"</span>:<span class="number">256</span>,</span><br><span class="line">                            <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"aliases"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"primary_terms"</span>:&#123;</span><br><span class="line">        <span class="attr">"0"</span>:<span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"in_sync_allocations"</span>:&#123;</span><br><span class="line">        <span class="attr">"0"</span>:[</span><br><span class="line">            <span class="string">"0xyG_6vxQ2WWQ6Z0lGVFBQ"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>查询所有账户，并按账户号码升序排序</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">  <span class="attr">"sort"</span>: [</span><br><span class="line">    &#123; <span class="attr">"account_number"</span>: <span class="string">"asc"</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，返回 <code>10</code> 条数据，可以通过指定 <code>size</code> 参数来改变返回的最大数量</p>
</li>
<li><p>分页查询</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">  <span class="attr">"sort"</span>: [</span><br><span class="line">    &#123; <span class="attr">"account_number"</span>: <span class="string">"asc"</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"from"</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>模糊匹配</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123; </span><br><span class="line">      <span class="attr">"match"</span>: &#123; <span class="attr">"address"</span>: <span class="string">"mill lane"</span> &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回地址中包含 <code>mill</code> 和 <code>lane</code> 的记录</p>
</li>
<li><p>复合查询</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"must"</span>: [</span><br><span class="line">        &#123; <span class="attr">"match"</span>: &#123; <span class="attr">"age"</span>: <span class="string">"40"</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"must_not"</span>: [</span><br><span class="line">        &#123; <span class="attr">"match"</span>: &#123; <span class="attr">"state"</span>: <span class="string">"ID"</span> &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回所有年龄在 <code>40</code> 岁，但是没有居住在 <code>ID</code> (爱荷华州)</p>
<p>注意 <code>must</code> 、<code>should</code> 会影响评分</p>
<p><code>must_not</code> 不会影响评分</p>
</li>
<li><p>范围查询</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"must"</span>: &#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">      <span class="attr">"filter"</span>: &#123;</span><br><span class="line">        <span class="attr">"range"</span>: &#123;</span><br><span class="line">          <span class="attr">"balance"</span>: &#123;</span><br><span class="line">            <span class="attr">"gte"</span>: <span class="number">20000</span>,</span><br><span class="line">            <span class="attr">"lte"</span>: <span class="number">30000</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询出工资在 <code>[20000,30000]</code> 的数据</p>
</li>
<li><p>查出每个州的账户数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;group_by_state&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;state.keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回结果如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">29</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span> : &#123;</span><br><span class="line">     <span class="attr">"total"</span> : &#123;</span><br><span class="line">        <span class="attr">"value"</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="attr">"relation"</span>: <span class="string">"eq"</span></span><br><span class="line">     &#125;,</span><br><span class="line">    <span class="attr">"max_score"</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="attr">"group_by_state"</span> : &#123;</span><br><span class="line">      <span class="attr">"doc_count_error_upper_bound"</span>: <span class="number">20</span>,</span><br><span class="line">      <span class="attr">"sum_other_doc_count"</span>: <span class="number">770</span>,</span><br><span class="line">      <span class="attr">"buckets"</span> : [ &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"ID"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">27</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"TX"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">27</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"AL"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">25</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"MD"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">25</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"TN"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">23</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"MA"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">21</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"NC"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">21</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"ND"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">21</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"ME"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">20</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key"</span> : <span class="string">"MO"</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">20</span></span><br><span class="line">      &#125; ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于查询的时候指定 <code>size=0</code>，所以 <code>hits</code> 字段长度为 <code>0</code>。</p>
</li>
<li><p>返回每个州的的账户数量，以及平均工资</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"group_by_state"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"state.keyword"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">        <span class="attr">"average_balance"</span>: &#123;</span><br><span class="line">          <span class="attr">"avg"</span>: &#123;</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"balance"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>指定已平均工资降序排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;group_by_state&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;state.keyword&quot;,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;average_balance&quot;: &quot;desc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;average_balance&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/22/java初始化值/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/12/22/java初始化值/" class="post-title-link" itemprop="http://yoursite.com/index.html">java初始化值</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-12-22 16:13:24 / 修改时间：16:17:01" itemprop="dateCreated datePublished" datetime="2019-12-22T16:13:24+08:00">2019-12-22</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在类的成员变量中，<code>java</code>的基本数据（此处包含 <code>String</code>）类型将会赋初值</p>
<table>
<thead>
<tr>
<th><strong>Data Type</strong></th>
<th><strong>Default Value (for fields)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>byte</td>
<td>0</td>
</tr>
<tr>
<td>short</td>
<td>0</td>
</tr>
<tr>
<td>int</td>
<td>0</td>
</tr>
<tr>
<td>long</td>
<td>0L</td>
</tr>
<tr>
<td>float</td>
<td>0.0f</td>
</tr>
<tr>
<td>double</td>
<td>0.0d</td>
</tr>
<tr>
<td>char</td>
<td>‘\u0000’</td>
</tr>
<tr>
<td>String (or any object)</td>
<td>null</td>
</tr>
<tr>
<td>boolean</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>局部变量略有不同。编译器永远不会将默认值分配给未初始化的局部变量。如果您无法在声明它的地方初始化本地变量，请确保在尝试使用它之前为其分配一个值。访问未初始化的局部变量将导致编译时错误。</p>
<p><a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html" target="_blank" rel="noopener">官方文档</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/07/rabbitmq进阶/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bruce Liu">
      <meta itemprop="description" content="Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce Liu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/12/07/rabbitmq进阶/" class="post-title-link" itemprop="http://yoursite.com/index.html">rabbitmq进阶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-12-07 16:42:40 / 修改时间：18:24:45" itemprop="dateCreated datePublished" datetime="2019-12-07T16:42:40+08:00">2019-12-07</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>交换机（exchange）的属性</p>
<p><code>autodelete</code> 当最后一个绑定到 Exchange 上的队列删除后，自动删除该 Exchange。</p>
<p>internal 当前Exchange 是否用于 RabbitMq 内部使用，默认为 false。</p>
<p>arguments 扩展参数，用于 AMQP 协议自制订化使用</p>
<h2 id="消息如何保障-100-的投递成功"><a href="#消息如何保障-100-的投递成功" class="headerlink" title="消息如何保障 100 % 的投递成功"></a>消息如何保障 100 % 的投递成功</h2><h3 id="什么是生产端的可靠性投递"><a href="#什么是生产端的可靠性投递" class="headerlink" title="什么是生产端的可靠性投递"></a>什么是生产端的可靠性投递</h3><ol>
<li>保障消息成功发出。</li>
<li>保障MQ 节点的成功接收。</li>
<li>发送端到MQ节点的（Broker）确认应答。</li>
<li>完善的消息进行补偿机制。</li>
</ol>
<p>解决方法</p>
<ol>
<li><p>消息落库，对消息状态进行打标</p>
<p>发送消息时，将消息持久化到数据库，并设置一个状态，客户端会送应答之后进行状态变更。</p>
</li>
<li><p>消息的延迟投递，做二次确认，回调检查。</p>
<ol>
<li><p>业务数据入库</p>
</li>
<li><p>发送业务消息，并生成二次检查的消息</p>
</li>
<li><p>消费端收到这个消息正确处理之后，再生成一条消息，该消息由 call-back 进行监听，callback将其入库</p>
</li>
<li><p>生产段 经过几分钟之后 发送二次检查消息到 call-back，查看刚才的业务是否处理成功，如果成功则不进行任何操作，如果失败 call-back 会发起一个 rpc 请求，让生产端进行重发。</p>
</li>
</ol>
</li>
</ol>
<h2 id="幂等性的概念"><a href="#幂等性的概念" class="headerlink" title="幂等性的概念"></a>幂等性的概念</h2><p>可以借鉴数据库乐观锁的机制</p>
<p>比如执行如下的一条sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_reps <span class="keyword">set</span> <span class="keyword">count</span> = <span class="keyword">count</span><span class="number">-1</span>,<span class="keyword">version</span>=<span class="keyword">version</span>+<span class="number">1</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'xiaomi9'</span></span><br></pre></td></tr></table></figure>
<p>如果现在某个手机在数据库中 <code>count=1</code>, 而且 <code>version=1</code>,在执行上面的 <code>sql</code> 的时候，应该首先查询数据库,多个进程应该查询数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>,<span class="keyword">version</span> <span class="keyword">from</span> t_reps <span class="keyword">where</span> <span class="keyword">id</span> =<span class="string">'xiaomi9'</span>;</span><br></pre></td></tr></table></figure>
<p>多个消费者进程可能都会查到这条数据，假设 count = 1, version=1</p>
<p>将上面的 sql 更改为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_reps <span class="keyword">set</span> <span class="keyword">count</span> = <span class="keyword">count</span><span class="number">-1</span>,<span class="keyword">version</span>=<span class="keyword">version</span>+<span class="number">1</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'xiaomi9'</span> <span class="keyword">and</span> <span class="keyword">version</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>可以避免多个进程的重复操作。</p>
<h2 id="消费端-幂等性保障"><a href="#消费端-幂等性保障" class="headerlink" title="消费端-幂等性保障"></a>消费端-幂等性保障</h2><ol>
<li><p>唯一id+指纹码 机制</p>
<p>唯一id + 指纹码机制，利用数据库主键去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> t_order <span class="keyword">where</span> <span class="keyword">id</span> = 唯一<span class="keyword">id</span>+指纹码</span><br></pre></td></tr></table></figure>
<p>好处 实现简单</p>
<p>坏处 高并发下有数据库写入的性能瓶颈</p>
<p>解决方案 数据库路由</p>
</li>
</ol>
<ol start="2">
<li><p>使用 redis 的原子性特性</p>
<p>redis 进行幂等，需要考虑的问题：</p>
<ol>
<li>我们是否要进行数据的落库，如果落库的话，关键问题是数据库和缓存如何做到原子性</li>
<li>如果不进行落库，那么都存储到缓存中，如何设置定时的同步策略。</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Bruce Liu</p>
              <p class="site-description motion-element" itemprop="description">Bruce Liu个人站，主要涉及前端知识共享、实践教程、前沿技术共同学习等方面</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">43</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/lastdetective" title="GitHub &rarr; https://github.com/lastdetective" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:xlgjsj004@sina.com" title="E-Mail &rarr; mailto:xlgjsj004@sina.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bruce Liu</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
